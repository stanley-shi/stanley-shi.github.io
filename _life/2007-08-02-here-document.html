---
layout: post
title: Here Document
date: '2007-08-01T19:45:00.000-07:00'
author: Stanley Shi
tags:
- Linux shell
modified_time: '2007-08-01T23:23:57.028-07:00'
blogger_id: tag:blogger.com,1999:blog-9061829565455522120.post-7873705301497413957
blogger_orig_url: http://dmshi.blogspot.com/2007/08/here-document.html
---

copy from the book: < learning perl ><br />Here-Document<br />The << label redirector essentially forces the input to a command to be the shell's standard input, which is read until there is a line that contains only label. The input in between is called a here-document. Here-documents aren't very interesting when used from the command prompt. In fact, it's the same as the normal use of standard input except for the label. We could use a here-document to simulate the mail facility. When you send a message to someone with the mail utility, you end the message with a dot (.). The body of the message is saved in a file, msgfile:<br />$ cat >> msgfile << .<br />  > this is the text of<br />  > our message.<br />  > .<br />Here-documents are meant to be used from within shell scripts; they let you specify "batch" input to programs. A common use of here-documents is with simple text editors like ed. Task 7-1 is a programming task that uses a here-document in this way.<br />Task 7-1<br />The s file command in mail saves the current message in file. If the message came over a network (such as the Internet), then it has several header lines prepended that give information about network routing. Write a shell script that deletes the header lines from the file.<br />We can use ed to delete the header lines. To do this, we need to know something about the syntax of mail messages; specifically, that there is always a blank line between the header lines and the message text. The ed command 1,/^[]*$/d does the trick: it means, "Delete from line 1 until the first blank line." We also need the ed commands w (write the changed file) and q (quit). Here is the code that solves the task:<br />ed $1 << EOF<br />1,/^[ ]*$/d<br />w<br />q<br />EOF<br />The shell does parameter (variable) substitution and command substitution on text in a here-document, meaning that you can use shell variables and commands to customize the text. A good example of this is the bashbug script, which sends a bug report to the bash maintainer (see Chapter 11). Here is a stripped-down version:<br />MACHINE="i586"<br />OS="linux-gnu"<br />CC="gcc"<br />CFLAGS=" -DPROGRAM='bash' -DHOSTTYPE='i586' -DOSTYPE='linux-gnu' \<br />    -DMACHTYPE='i586-pc-linux-gnu' -DSHELL -DHAVE_CONFIG_H   -I. \<br />    -I. -I./lib -g -O2"<br />RELEASE="2.01"<br />PATCHLEVEL="0"<br />RELSTATUS="release"<br />MACHTYPE="i586-pc-linux-gnu"<br /> <br />TEMP=/tmp/bbug.$$<br /> <br />case "$RELSTATUS" in<br />alpha*|beta*)   BUGBASH=chet@po.cwru.edu ;;<br />*)              BUGBASH=bug-bash@prep.ai.mit.edu ;;<br />esac<br /> <br />BUGADDR="${1-$BUGBASH}"<br /> <br />UN=<br />if (uname) >/dev/null 2>&1; then<br />        UN=`uname -a`<br />fi<br /> <br />cat > $TEMP <<EOF<br />From: ${USER}<br />To: ${BUGADDR}<br />Subject: [50 character or so descriptive subject here (for reference)]<br /> <br />Configuration Information [Automatically generated, do not change]:<br />Machine: $MACHINE<br />OS: $OS<br />Compiler: $CC<br />Compilation CFLAGS: $CFLAGS<br />uname output: $UN<br />Machine Type: $MACHTYPE<br /> <br />bash Version: $RELEASE<br />Patch Level: $PATCHLEVEL<br />Release Status: $RELSTATUS<br /> <br />Description:<br />        [Detailed description of the problem, suggestion, or complaint.]<br /> <br />Repeat-By:<br />        [Describe the sequence of events that causes the problem<br />        to occur.]<br /> <br />Fix:<br />        [Description of how to fix the problem.  If you don't know a<br />        fix for the problem, don't include this section.]<br />EOF<br /> <br />vi $TEMP<br /> <br />mail $BUGADDR < $TEMP<br />The first eight lines are generated when bashbug is installed. The shell will then substitute the appropriate values for the variables in the text whenever the script is run.<br />The redirector << has two variations. First, you can prevent the shell from doing parameter and command substitution by surrounding the label in single or double quotes. In the above example, if you used the line cat > $TEMP <<'EOF', then text like $USER and $MACHINE would remain untouched (defeating the purpose of this particular script).<br />The second variation is <<-, which deletes leading TABs (but not blanks) from the here-document and the label line. This allows you to indent the here-document's text, making the shell script more readable:<br />cat > $TEMP <<-EOF<br />        From: ${USER}<br />        To: ${BUGADDR}<br />        Subject: [50 character or so descriptive subject here]<br /> <br />        Configuration Information [Automatically generated,<br />            do not change]:<br />        Machine: $MACHINE<br />        OS: $OS<br />        Compiler: $CC<br />        Compilation CFLAGS: $CFLAGS<br />        ...<br />EOF<br />Make sure you are careful when choosing your label so that it doesn't appear as an actual input line.