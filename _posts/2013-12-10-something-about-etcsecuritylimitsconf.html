---
layout: post
title: something about /etc/security/limits.conf
date: '2013-12-10T11:00:00.002+08:00'
author: Stanley Shi
tags: 
modified_time: '2013-12-10T11:35:13.840+08:00'
blogger_id: tag:blogger.com,1999:blog-4195205503550406237.post-1305088868653408325
blogger_orig_url: http://eng-architect.blogspot.com/2013/12/something-about-etcsecuritylimitsconf.html
---

<div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">Yesterday when I was working on the Hadoop UT timeout issue, I found something that need to be noted.</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;"><br /></div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">Normally we can set the limits by editing the file /etc/security/limits.conf, for example, the following line:</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;"><i>&nbsp; &nbsp;* soft nproc 10240</i></div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">will change the default maximum number of process that user can open.</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">There's a hidden thing here:</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">By default, system will read this file first and then read all files in the folder "/etc/security/limits.d". In CentOS (6.4), there's an default file here named "90-nproc.conf", it has the following content:</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">"</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;"><div><em># Default limit for number of user's processes to prevent</em></div><div><em># accidental fork bombs.</em></div><div><em># See rhbz #432903 for reasoning.</em></div><div><em><br /></em></div><div><em>* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;soft &nbsp; &nbsp;nproc &nbsp; &nbsp; 1024</em></div><div><em>root &nbsp; &nbsp; &nbsp; soft &nbsp; &nbsp;nproc &nbsp; &nbsp; unlimited</em></div></div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">"</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">YES, it overwrite the default value for normal user here.&nbsp;</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">So if you only set the nproc in limits.conf, no matter how much you set, you only got 1024!</div><div style="background-color: white; color: #333333; font-family: Arial, sans-serif; font-size: 14.399999618530273px; line-height: 16px;">The correct way to do this is to create another file in /etc/security/limits.d named something that is alphabetically greater than the file "90-nproc.conf" and put your settings there, for example, "stanley.conf" will be a good name for user stanley<img alt="(smile)" class="emoticon emoticon-smile" data-emoticon-name="smile" src="https://confluence.greenplum.com/s/en_GB-1988229788/4224/875a2723d3ca93f267db5c35cdbfcf91f5910d2d.36/_/images/icons/emoticons/smile.png" style="vertical-align: middle;" /></div>