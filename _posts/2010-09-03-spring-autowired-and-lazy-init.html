---
layout: post
title: Spring @Autowired and lazy-init
date: '2010-09-02T23:56:00.001-07:00'
author: Stanley Shi
tags: 
modified_time: '2010-09-02T23:56:49.891-07:00'
blogger_id: tag:blogger.com,1999:blog-9061829565455522120.post-8325816289977600881
blogger_orig_url: http://dmshi.blogspot.com/2010/09/spring-autowired-and-lazy-init.html
---

<p>Today when I was trying to do some TDD test, I wrote a test file and used the following code:</p>  <p>The test code:</p>  <p><em>@ContextConfiguration      <br />@RunWith(SpringJUnit4ClassRunner.class)       <br />public class CommandParserTest {       <br />&#160;&#160;&#160; @Autowired       <br />&#160;&#160;&#160; private CommandParser parser;       <br />&#160;&#160;&#160; @Autowired       <br />&#160;&#160;&#160; private ISaleEventListener listener; </em></p>  <p><em>&#160;&#160;&#160; @Test      <br />&#160;&#160;&#160; public void test1(){       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; fail(&quot;nothing&quot;);       <br />&#160;&#160;&#160; }       <br />}</em></p>  <p>Here “CommandParser” is a normal class and ISaleEventListener is an interface, the implementation of them are not important.</p>  <p>The spring context file:</p>  <p><em>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;      <br />&lt;beans xmlns=&quot;</em><a href="http://www.springframework.org/schema/beans&quot;"><em>http://www.springframework.org/schema/beans&quot;</em></a>     <br /><em>&#160;&#160;&#160; xmlns:xsi=&quot;</em><a href="http://www.w3.org/2001/XMLSchema-instance&quot;"><em>http://www.w3.org/2001/XMLSchema-instance&quot;</em></a>     <br /><em>&#160;&#160;&#160; xmlns:context=&quot;</em><a href="http://www.springframework.org/schema/context&quot;"><em>http://www.springframework.org/schema/context&quot;</em></a>     <br /><em>&#160;&#160;&#160; xsi:schemaLocation=&quot;</em><a href="http://www.springframework.org/schema/beans"><em>http://www.springframework.org/schema/beans</em></a><em> </em><a href="http://www.springframework.org/schema/beans/spring-beans.xsd"><em>http://www.springframework.org/schema/beans/spring-beans.xsd</em></a>     <br /><a href="http://www.springframework.org/schema/context"><em>http://www.springframework.org/schema/context</em></a><em> </em><a href="http://www.springframework.org/schema/context/spring-context.xsd&quot;"><em>http://www.springframework.org/schema/context/spring-context.xsd&quot;</em></a>     <br /><em>&#160;&#160;&#160; default-lazy-init=&quot;true&quot;&gt; </em></p>  <p><em>&#160;&#160;&#160; &lt;bean id=&quot;parser&quot; class=&quot;com.stanley.check.CommandParser&quot;&gt;      <br />&#160;&#160;&#160; &lt;/bean&gt;       <br />&#160;&#160;&#160; &lt;bean id=&quot;listener&quot; class=&quot;org.easymock.EasyMock&quot;       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; factory-method=&quot;createMock&quot; lazy-init=&quot;false&quot;&gt;       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;constructor-arg value=&quot;com.stanley.check.ISaleEventListener&quot;&gt;&lt;/constructor-arg&gt;       <br />&#160;&#160;&#160; &lt;/bean&gt;       <br />&#160;&#160;&#160; &lt;bean id=&quot;test&quot; class=&quot;com.stanley.check.CommandParserTest&quot;       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; lazy-init=&quot;false&quot;&gt;       <br />&#160;&#160;&#160; &lt;/bean&gt;       <br />&lt;/beans&gt;</em></p>  <p>For the above code, the output will be a simple JUnit fail;</p>  <p>But if you change the “lazy-init” for the bean “listener” to be true, you’ll get some <strong>error</strong> warns you that it cannot do the autowiring because it cannot find some ISaleEventListener;</p>  <p>If you move the declaration of the “test” bean to the top of the context file, you’ll also get the error that cannot find the ISaleEventListener;</p>  <p>So our explanation for this situation is that: </p>  <ul>   <li>Before the bean “listener” is initialized, the Spring doesn’t know its type; so if you change the “laze-init” to be true, spring will not initialize it at the start time, so when the test want to do the autowiring, it report that it cannot find ISaleEventListener; </li>    <li>For the other one, spring read the context file in order and will do initializing in the same order if there’s no dependencies; so if the “test” bean is at the top of the context file, it will be initialized first, before the initializing of the “listener” bean. At that time, spring will try to find if there’s some other beans defined in the context file match the autowiring scenario, if found, the dependent bean will be initialized and injected to the “test” bean; but in this case, spring don’t know that the “listener” will be of the type “ISaleEventListener”, so it reports that it cannot do the autowiring. </li> </ul>  <p>These are concluded from the phenomenon, not from any formal spring documentations. So if you have any thoughts on this, please leave your comments.</p>  