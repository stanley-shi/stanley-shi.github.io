---
layout: post
title: Using ftp in scripts –FMI serials
date: '2009-10-28T09:35:00.001+08:00'
author: Stanley Shi
tags: 
modified_time: '2009-10-28T13:50:07.942+08:00'
blogger_id: tag:blogger.com,1999:blog-4195205503550406237.post-6427628819315367443
blogger_orig_url: http://eng-architect.blogspot.com/2009/10/using-ftp-in-scripts-fmi-serials.html
---

<p>In my working environment, I have two computers, one desktop machine and one laptop. Usually I run Windows on my laptop and Linux on my desktop. Our company use the Windows Domain to manage the computers, so when I login to the domain, the system will correlate the IP of the laptop to some DNS name; but for the Linux-running desktop, I cannot access it through DNS name. Every time I restart the desktop, it may change IP (due to the DHCP in the company), so I don’t know how to access it if I don’t check manually.</p>  <p>There’s one scenario that I want to use the desktop remotely: when I work at home, I use VPN to connect to the company’s intranet, then if i know the IP of my desktop machine, I can access via SSH.</p>  <p>Today I wrote a simple shell script on my machine. This script does one very simple work: it reads the IP of the local machine, writes this in some file, and then upload the file onto some ftp server.&#160; Then I can get the IP address of my desktop via the ftp server. I set the script to run when the computer starts.</p>  <p>This is a very simple script contains about only 5~6 line of code, only two knowledge spots:</p>  <ol>   <li>Get the IP address of the current machine      <ul>       <li>the code is:          <table border="0" cellspacing="0" cellpadding="2" width="484"><tbody>             <tr>               <td valign="top" width="482">ifconfig eth0 |grep ‘inet addr:’|cut –d: –f2 | awk ‘{print $1}’</td>             </tr>           </tbody></table> this line of code will return the IP address assigned to the eth0 interface. </li>     </ul>      <ul></ul>   </li>    <li>Put the file onto some ftp server      <ul>       <li>in normal situation, ftp will read user name and password from the console input, but when using ftp in scripts, it cannot account on the user to input password manually, so we need to do it this way:          <table border="0" cellspacing="0" cellpadding="2" width="484"><tbody>             <tr>               <td valign="top" width="482">                 <pre>ftp -n $HOST &lt;&lt;END_SCRIPT<br />quote USER $USER<br />quote PASS $PASSWD<br />put $FILE<br />quit<br />END_SCRIPT<br />exit 0</pre><br />              </td><br />            </tr><br />          </tbody></table><br /><br />        <p>There are two tricks here: </p><br /><br />        <ol><br />          <li>Using the <kbd>-n</kbd> option on the ftp client program to prevent the ftp client from trying to log in immediately. That way, the ftp client does not ask for a user ID and password. No use of <kbd>/dev/tty</kbd>. </li><br /><br />          <li>Use the ftp client program command <kbd>quote</kbd> to send user ID and password to the ftp server. </li><br />        </ol><br />      </li><br />    </ul><br />  </li><br /><br />  <li>Combining these two together, I have this script to do the work: <br />    <ol><br />      <table border="0" cellspacing="0" cellpadding="2" width="400"><tbody><br />          <tr><br />            <td valign="top" width="400">#!/bin/sh<br />HOST='10.32.105.126'<br />USER='ftpuser'<br />PASS='adv@nc3d'<br />FILE='ip.txt'<br />ifconfig eth0 |grep 'inet addr:'|cut -d: -f2|awk '{print $1}' >$FILE<br />ftp -n $HOST &lt;&lt;END_SCRIPT<br />quote USER $USER<br />quote PASS $PASS<br />cd Users/shid<br />put $FILE<br />bye<br />END_SCRIPT<br />rm -f $FILE<br />exit 0<br /><br /></td><br />          </tr><br />        </tbody></table><br />    </ol><br />  </li><br /></ol>